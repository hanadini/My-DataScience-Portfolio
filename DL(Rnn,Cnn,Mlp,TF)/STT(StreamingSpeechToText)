
import warnings
warnings.filterwarnings("ignore")

import speech_recognition as sr
import threading
import time

def callback(recognizer, audio):
    try:
        # Recognize speech using Google Web Speech API with Turkish language
        text = recognizer.recognize_google(audio, language="tr-TR")
        print("You said:", text)
    except sr.UnknownValueError:
        print("Could not understand audio")
    except sr.RequestError as e:
        print(f"Could not request results from Google Speech Recognition service; {e}")
    except Exception as e:
        print(f"An unexpected error occurred: {e}")

# Initialize the recognizer and microphone outside the context managers
recognizer = sr.Recognizer()
microphone = sr.Microphone()

# Open the microphone for streaming
with microphone as source:
    print("Listening...")

    # Adjust for ambient noise
    recognizer.adjust_for_ambient_noise(source)

    # Define the background recognition thread
    def recognize_background():
        while True:
            try:
                audio = recognizer.listen(source)
                callback(recognizer, audio)
            except Exception as e:
                print(f"An unexpected error occurred in the background thread: {e}")

    # Start the background recognition thread
    background_thread = threading.Thread(target=recognize_background)
    background_thread.daemon = True
    background_thread.start()

    # Keep the main thread running indefinitely
    try:
        while True:
            time.sleep(0.1)
    except KeyboardInterrupt:
        print("Stopped listening.")
